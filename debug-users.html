<!DOCTYPE html>
<html>
<head>
    <title>Debug Users - Check Existing Accounts</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .user-card { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 8px; 
            padding: 15px; 
            margin: 10px 0; 
        }
        .user-email { 
            font-weight: bold; 
            color: #007bff; 
        }
        .user-type { 
            background: #28a745; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
        }
        .password-info { 
            font-family: monospace; 
            background: #e9ecef; 
            padding: 5px; 
            border-radius: 4px; 
            margin-top: 5px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { 
            background: #0056b3; 
        }
        .test-result { 
            margin-top: 10px; 
            padding: 10px; 
            border-radius: 5px; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç User Account Debugger</h1>
        <p>This tool helps debug login issues by showing existing users and testing authentication.</p>
        
        <button onclick="loadUsers()">üîÑ Load Users</button>
        <button onclick="testAllLogins()">üß™ Test All Logins</button>
        <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
        
        <div id="userList"></div>
        <div id="testResults"></div>
    </div>

    <script>
        function loadUsers() {
            const userList = document.getElementById('userList');
            
            // Check multiple storage locations
            const sources = [
                { name: 'trinck-registered-users', key: 'trinck-registered-users' },
                { name: 'trink_users', key: 'trink_users' },
                { name: 'auth-storage', key: 'auth-storage' }
            ];
            
            let allUsers = [];
            let html = '<h2>üìä User Storage Analysis</h2>';
            
            sources.forEach(source => {
                const data = localStorage.getItem(source.key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        html += `<h3>Storage: ${source.name}</h3>`;
                        
                        if (Array.isArray(parsed)) {
                            allUsers = allUsers.concat(parsed);
                            html += `<p>Found ${parsed.length} users</p>`;
                            parsed.forEach(user => {
                                html += createUserCard(user);
                            });
                        } else if (parsed.user) {
                            // Zustand store format
                            html += `<p>Current logged in user:</p>`;
                            html += createUserCard(parsed.user);
                        } else {
                            html += `<p>Data format: ${typeof parsed}</p>`;
                        }
                    } catch (error) {
                        html += `<p>‚ùå Error parsing ${source.name}: ${error.message}</p>`;
                    }
                } else {
                    html += `<p>‚ùå No data in ${source.name}</p>`;
                }
            });
            
            if (allUsers.length === 0) {
                html += '<p><strong>‚ö†Ô∏è No users found in any storage location!</strong></p>';
                html += '<p>This explains why login is failing. You need to register some users first.</p>';
            }
            
            userList.innerHTML = html;
        }
        
        function createUserCard(user) {
            const passwordType = user.password && user.password.includes(':') ? 'Hashed' : 'Plaintext';
            const passwordLength = user.password ? user.password.length : 0;
            
            return `
                <div class="user-card">
                    <div class="user-email">${user.email || user.name}</div>
                    <span class="user-type">${user.type || 'Unknown'}</span>
                    <div class="password-info">
                        Password: ${passwordType} (${passwordLength} chars)
                        ${user.password ? user.password.substring(0, 20) + '...' : 'No password'}
                    </div>
                    <button onclick="testLogin('${user.email}', '${user.type}')">üß™ Test Login</button>
                </div>
            `;
        }
        
        function testLogin(email, userType) {
            const password = prompt(`Enter password for ${email}:`);
            if (!password) return;
            
            // Test with the useAuth store method (simulated)
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = `<h3>üß™ Testing Login for ${email}</h3><p>Testing...</p>`;
            
            // Simulate the login logic
            const users = JSON.parse(localStorage.getItem('trinck-registered-users') || '[]');
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.type === userType);
            
            if (!user) {
                testResults.innerHTML += `<div class="test-result error">‚ùå User not found</div>`;
                return;
            }
            
            // Test password verification
            const isPlaintextMatch = user.password === password;
            const result = isPlaintextMatch ? 'SUCCESS' : 'FAILED';
            const resultClass = isPlaintextMatch ? 'success' : 'error';
            
            testResults.innerHTML += `
                <div class="test-result ${resultClass}">
                    ${result === 'SUCCESS' ? '‚úÖ' : '‚ùå'} Password verification: ${result}
                    <br>Stored password: ${user.password.substring(0, 20)}...
                    <br>Entered password: ${password}
                    <br>Match type: ${isPlaintextMatch ? 'Plaintext' : 'None'}
                </div>
            `;
        }
        
        function testAllLogins() {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = '<h3>üß™ Testing All User Authentication</h3>';
            
            const users = JSON.parse(localStorage.getItem('trinck-registered-users') || '[]');
            
            if (users.length === 0) {
                testResults.innerHTML += '<div class="test-result error">‚ùå No users to test</div>';
                return;
            }
            
            users.forEach(user => {
                testResults.innerHTML += `
                    <div class="test-result">
                        <strong>${user.email}</strong> (${user.type})
                        <br>Password format: ${user.password && user.password.includes(':') ? 'Hashed' : 'Plaintext'}
                        <br>Ready for login: ${user.password ? '‚úÖ Yes' : '‚ùå No password set'}
                    </div>
                `;
            });
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all user data? This cannot be undone.')) {
                localStorage.clear();
                sessionStorage.clear();
                document.getElementById('userList').innerHTML = '<p>‚úÖ All data cleared</p>';
                document.getElementById('testResults').innerHTML = '';
            }
        }
        
        // Auto-load users on page load
        window.onload = loadUsers;
    </script>
</body>
</html>
